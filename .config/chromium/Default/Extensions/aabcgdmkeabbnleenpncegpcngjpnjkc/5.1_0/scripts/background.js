/*Copyright (c) 2019 ksoft http://www.dummysoftware.com*/function onInitialize(){chrome.tabs.getAllInWindow(null,function(e){VeLao(e)});chrome.tabs.onUpdated.addListener(function(e,t,n){lTsFy(n)}),chrome.tabs.onRemoved.addListener(function(e,t){FIOsE(e)}),chrome.extension.onRequest.addListener(function(e,t,n){onRequest(e)}),chrome.runtime.onMessage.addListener(function(e,t,n){onMessage(e)}),chrome.runtime.onInstalled.addListener(function(e){JCPRS(e)}),chrome.notifications.onClicked.addListener(function(e){YGuKi(e)}),canvas.width=19,canvas.height=19,hleGS.src=cQkKj.on}function JCPRS(e){var t=chrome.runtime.getManifest().version;"install"==e.reason?chrome.tabs.create({url:"http://www.dummysoftware.com/easy-auto-refresh/?action=install&new="+t}):"update"==e.reason&&e.previousVersion>0&&e.previousVersion<6&&chrome.tabs.create({url:"http://www.dummysoftware.com/easy-auto-refresh/?action=update&old="+e.previousVersion+"&new="+t})}function VeLao(e){for(var t,n=0;t=e[n];n++)XFKYG(t.url)||IdECh(t)}function lTsFy(e){XFKYG(e.url)||(IdECh(e),zWZLp(e))}function FIOsE(e){MpTMm({id:e},!1)}function IdECh(e){1==getOptions(e).refresh?(chrome.pageAction.setIcon({path:cQkKj.on,tabId:e.id}),onRequest({tab:e,refresh:!0})):(chrome.pageAction.setIcon({path:cQkKj.off,tabId:e.id}),MpTMm(e,!0)),chrome.pageAction.show(e.id)}function XFKYG(e){return e.indexOf("chrome:")>-1}function fhrto(e){for(var t=0;t<blkPZ.length;t++){var n=blkPZ[t];if(n.tab.id==e.id)return n}return null}function ItUJH(e){for(var t=0;t<blkPZ.length;t++)if(blkPZ[t]==e)return void blkPZ.splice(t,1)}function MpTMm(e,t){var n=fhrto(e);if(null!=n&&(clearInterval(n.intervalId),clearInterval(n.timerIntervalId),ItUJH(n),delete aESbJ["tab"+e.id],t&&(chrome.pageAction.setIcon({path:cQkKj.off,tabId:e.id}),chrome.pageAction.show(e.id),chrome.pageAction.setTitle({tabId:e.id,title:"Easy Auto Refresh"})),null!=e.url)){-1==e.url.indexOf("chrome.google.com")&&-1==e.url.indexOf("file://")&&chrome.tabs.executeScript(e.id,{code:"keyPressManager.remove();"});var i=getOptions(e);i.lastRefresh=null,i.nextRefresh=null,saveOptions(e,i)}}function nArSh(e,t,n){var i=fhrto(e);return null!=i&&i.intervalValue==t&&(n.isDomain?getDomain(i.tab.url)==getDomain(e.url):i.tab.url==e.url)}function RFyMX(e,t){var n=new Date,i=new Date(yyelB["tab"+e.id]),a=Math.round((n-i)/1e3);if(isNaN(a)||a>1){var o=1==t.isAutoClick&&null!=t.autoClickId&&t.autoClickId.length>0&&"1"==t.autoClickIdValid;if(o&&!t.isAutoClickAfterRefresh)wMJJD(e,t.autoClickId),yyelB["tab"+e.id]=n;else if(1==t.isUrlList&&t.urlList&&t.urlList.length>0){var r=0,s=t.urlListLast;s&&(r=t.urlList.indexOf(s),r>-1?r++:r=0,r>=t.urlList.length&&(r=0));var c=t.urlList[r];if(c){t.urlListLast=c;var l=c,d=c.split("/");d&&d.length<=3&&(l+="/"),saveOptions({url:l},t),chrome.tabs.update(e.id,{url:c},function(e){lTAtA(e)})}}else-1==e.url.indexOf("chrome.google.com")&&-1==e.url.indexOf("file://")?chrome.tabs.executeScript(e.id,{code:"location.reload(true);"},function(t){lTAtA(t,function(t){t&&chrome.tabs.update(e.id,{url:e.url})})}):chrome.tabs.update(e.id,{url:e.url});if(o&&t.isAutoClickAfterRefresh){var f=fhrto(e);f&&(f.autoClickId=t.autoClickId)}}}function refresh(e,t){t.isAllTabs?chrome.tabs.query({windowId:e.windowId},function(e){for(var n in e)RFyMX(e[n],t)}):RFyMX(e,t)}function EXRcI(e){var t,n=getOptions(e);1==n.isRandom?(n=Jbyyg(e),t=n.random):gOGVT(n)?(n=pgcmQ(e),t=n.interval):t=n.interval,1==n.isCache&&chrome.browsingData.removeCache({since:0}),refresh(e,n),n=updateLastRefresh(n,t),saveOptions(e,n),chrome.runtime.sendMessage({message:"updateLastRefresh",lastRefresh:n.lastRefresh,nextRefresh:n.nextRefresh,tabId:e.id})}function onRequest(e){if(1==e.refresh){var t=getOptions(e.tab),n=1e3*t.interval;gOGVT(t)?(t=pgcmQ(e.tab),n=1e3*t.interval):null!=t.random&&(n=1e3*t.random),nArSh(e.tab,n,t)&&!e.force||(MpTMm(e.tab,!1),intervalId=setInterval(function(){EXRcI(e.tab,t.random)},n),timerIntervalId=setInterval(function(){zLwRi(e.tab)},1e3),blkPZ.push({tab:e.tab,intervalId:intervalId,timerIntervalId:timerIntervalId,intervalValue:n}),t=updateLastRefresh(t,n/1e3),saveOptions(e.tab,t)),-1==e.tab.url.indexOf("chrome.google.com")&&-1==e.tab.url.indexOf("file://")&&chrome.tabs.executeScript(e.tab.id,{code:"keyPressManager.setup("+e.tab.id+");"});var i=gOGVT(t)?t.nextRefresh:n/1e3+" seconds";chrome.pageAction.setIcon({path:cQkKj.on,tabId:e.tab.id}),chrome.pageAction.show(e.tab.id),chrome.pageAction.setTitle({tabId:e.tab.id,title:"Easy Auto Refresh ON : "+i})}else MpTMm(e.tab,!0)}function onMessage(e){"resetInterval"==e.action&&chrome.tabs.get(e.tabId,function(e){onRequest({tab:e,refresh:!0,force:!0}),chrome.pageAction.setIcon({path:cQkKj.restart,tabId:e.id}),chrome.pageAction.show(e.id),setTimeout(function(){var t=e;chrome.tabs.get(t.id,function(n){t.url==n.url&&(chrome.pageAction.setIcon({path:cQkKj.on,tabId:e.id}),chrome.pageAction.show(e.id))})},1e3)})}function Jbyyg(e){var t=getOptions(e),n=t.interval,i=parseInt(n,10);i<=10&&(i=60);var a=getRandomInt(10,i);return t.random=a,saveOptions(e,t),chrome.runtime.sendMessage({message:"updateRandomInterval",value:a,tabId:e.id}),onRequest({tab:e,refresh:!0}),t}function gOGVT(e){var t=!1;return e&&(t=1==e.isTimeList&&e.timeList&&e.timeList.length),t}function pgcmQ(e){for(var t=getOptions(e),n=t.interval,i=[],a=-1,o=-1,r=new Date,s=0;s<t.timeList.length;s++){var c=t.timeList[s],l=c.match(/^(\d{1,2}):(\d{2})$/);if(l&&l.length>=2){var d=l[1],f=l[2],u=60*parseInt(d)*60+parseInt(60*f),h=60*r.getHours()*60+60*r.getMinutes()+r.getSeconds(),m=u-h;i.push({time:c,seconds:m}),m>0&&(-1===a||m<i[a].seconds)?a=i.length-1:(-1===o||m<i[o].seconds)&&(o=i.length-1)}}return a>-1?n=i[a].seconds:o>-1&&(n=i[o].seconds,n=86400+n),t.interval=n,saveOptions(e,t),chrome.runtime.sendMessage({message:"updateTimeInterval",value:n,tabId:e.id}),t}function zLwRi(e){var t=getOptions(e),n=new Date,i=Date.parse(t.nextRefresh),a=t.isTimer?1e4:10;if(!isNaN(i)){var o=new Date(i),r=Math.round((o-n)/1e3);r>-1&&r<a?chrome.pageAction.setIcon({imageData:OtZyY(r,r>99?"8px Tahoma":"10px Courier New"),tabId:e.id}):gOGVT(t)||chrome.pageAction.setIcon({path:cQkKj.on,tabId:e.id})}}function OtZyY(e,t){var n=9,i=8,a=1;return t=t||"10px Courier New",e.toString().length>=2&&(n-=7,i+=7),e.toString().length>=4&&(i+=1,a=0),context.clearRect(0,0,canvas.width,canvas.height),context.drawImage(hleGS,0,0,canvas.width,canvas.height),context.fillStyle="#ffffff",context.fillRect(n,8,i,10),context.strokeStyle="#ff0000",context.strokeRect(n,8,i,10),context.fillStyle="black",context.font=t,context.fillText(e,n+a,16),context.getImageData(0,0,canvas.width,canvas.height)}function HyNla(e,t,n){var i=new Date,a=new Date(aESbJ["tab"+e.id]),o=Math.round((i-a)/1e3);(isNaN(o)||o>3)&&chrome.tabs.executeScript(e.id,{file:"scripts/content.js"},function(a){chrome.tabs.sendMessage(e.id,{action:"findText"+t,isText:n},function(n){void 0!==n&&1==n.result&&(aESbJ["tab"+e.id]=i,chrome.notifications.create("notification-"+e.windowId+"-"+e.id,{type:"basic",title:"Easy Auto Refresh",message:'The keyword "'+t.trim()+'" was found in Tab '+(e.index+1)+".",contextMessage:e.url,eventTime:i.getTime(),iconUrl:"images/notification.png"}),audio||(audio=new Audio,audio.src="images/notification.mp3"),audio.play())})})}function zWZLp(e){var t=getOptions(e);if(1==t.refresh&&t.isNotify&&t.notifyText){var n=0,i=!1,a=t.notifyText;a.toUpperCase().indexOf("[TEXT]")>0&&(i=!0,a=a.replace(/\[TEXT\]/i,"")),matches=a.match(/(.*)\[(\d+)\]/),matches&&matches.length>=3&&(n=parseInt(matches[2]))&&(n<0?n=0:n>9&&(n=9),a=matches[1],setTimeout(function(){HyNla(e,a,i)},1e3*n)),n||HyNla(e,a,i)}if(t.isAutoClickAfterRefresh){var o=fhrto(e);o&&o.autoClickId&&(delete o.autoClickId,wMJJD(e,t.autoClickId))}}function wMJJD(e,t){var n="";n=0==t.indexOf("document.")?"var link = null; try { link = "+t.replace(/"/g,"'")+" } catch(e) {} if (link != null) { link.click(); }":"var link = null; try { link = document.querySelector('"+t.replace(/'/g,"\\'").replace(/"/g,'\\"')+"'); } catch(e) {} if (link != null) { link.click(); }",chrome.tabs.executeScript(e.id,{code:n})}function YGuKi(e){var t=e.match(/notification-(\d+)-(\d+)/);if(null!=t&&3==t.length){var n=parseInt(t[1]),i=parseInt(t[2]);chrome.windows.update(n,{focused:!0}),chrome.tabs.update(i,{highlighted:!0}),chrome.notifications.clear(e)}}function lTAtA(e,t){if(void 0===e){var n=chrome.extension.lastError;if(n&&n.message)if(-1!=n.message.indexOf("No tab with id")){var i=n.message.match(/\d+/);i&&1==i.length&&MpTMm({id:i[0]})}else if(-1!=n.message.indexOf("Cannot access contents of the page"))return void(t&&t(!0))}t&&t()}var blkPZ=new Array,yyelB=[],aESbJ=[],canvas=document.createElement("canvas"),context=canvas.getContext("2d"),hleGS=new Image,audio=null,cQkKj={on:"images/refresh-on-38.png",off:"images/refresh-off-38.png",restart:"images/refresh-restart-38.png"};